# ç¬”è®°ç³»ç»Ÿå¢å¼ºè®¾è®¡æ–‡æ¡£

> **ğŸ“Œ å®æ–½çŠ¶æ€è¯´æ˜**
> - **å½“å‰å®ç°**: â¸ï¸ **éƒ¨åˆ†å®ç°** - åŸºç¡€åŠŸèƒ½å·²å°±ç»ª,é«˜çº§åŠŸèƒ½å¾…å¼€å‘
> - **å·²å®ç°åŠŸèƒ½ (è¿­ä»£1-2)**:
>   - âœ… é™„ä»¶ä¸Šä¼ /ä¸‹è½½API (`attachments.py`)
>   - âœ… æ–‡ä»¶å­˜å‚¨æœåŠ¡ (`file_storage.py`)
>   - âœ… ç¬”è®°é“¾æ¥ç³»ç»Ÿ (`links.py`)
>   - âœ… åŸºç¡€ç¬”è®°CRUDå’Œè¯­ä¹‰æœç´¢
> - **æœªå®ç°åŠŸèƒ½ (è¿­ä»£2-3)**:
>   - âŒ ç¬”è®°æ¨¡æ¿ç³»ç»Ÿ
>   - âŒ æ–‡ä»¶å¤¹å±‚çº§ç»„ç»‡ (parent_note_id)
>   - âŒ æ”¶è—å’Œç½®é¡¶åŠŸèƒ½ (is_pinned/is_favoritedå­—æ®µ)
>   - âŒ Notioné£æ ¼UIç»„ä»¶
>   - âŒ æœç´¢å†å²å’Œå…³é”®è¯é«˜äº®
>   - âŒ å…³ç³»å›¾è°±å¯è§†åŒ–
>
> **é‡è¦**: æœ¬æ–‡æ¡£ä¸ºå®Œæ•´å¢å¼ºè®¡åˆ’ã€‚å½“å‰ä»…å®Œæˆäº†é™„ä»¶ç®¡ç†å’Œé“¾æ¥ç³»ç»Ÿçš„åç«¯API,å‰ç«¯UIå’Œé«˜çº§åŠŸèƒ½å°šæœªå®æ–½ã€‚

---

> **é¡¹ç›®åç§°**: Personal Growth OS - ç¬”è®°ç³»ç»Ÿå…¨é¢å¢å¼º
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-19
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **è´Ÿè´£äºº**: Claude Code

---

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
- [2. éœ€æ±‚åˆ†æ](#2-éœ€æ±‚åˆ†æ)
- [3. æŠ€æœ¯æ¶æ„](#3-æŠ€æœ¯æ¶æ„)
- [4. æ•°æ®åº“è®¾è®¡](#4-æ•°æ®åº“è®¾è®¡)
- [5. APIè®¾è®¡](#5-apiè®¾è®¡)
- [6. å‰ç«¯ç»„ä»¶è®¾è®¡](#6-å‰ç«¯ç»„ä»¶è®¾è®¡)
- [7. å®æ–½è®¡åˆ’](#7-å®æ–½è®¡åˆ’)
- [8. é£é™©è¯„ä¼°](#8-é£é™©è¯„ä¼°)
- [9. æµ‹è¯•ç­–ç•¥](#9-æµ‹è¯•ç­–ç•¥)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

å½“å‰ç¬”è®°ç³»ç»ŸåŠŸèƒ½åŸºç¡€ï¼Œä»…æ”¯æŒç®€å•çš„Markdownç¼–è¾‘ã€æ ‡ç­¾å’Œé¡¹ç›®åˆ†ç±»ã€‚ç”¨æˆ·éœ€è¦æ›´å¼ºå¤§çš„çŸ¥è¯†ç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼š
- é™„ä»¶ç®¡ç†ï¼ˆæ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹ï¼‰
- ç¬”è®°æ¨¡æ¿ç³»ç»Ÿ
- æ–‡ä»¶å¤¹å±‚çº§ç»„ç»‡
- Wikié£æ ¼åŒå‘é“¾æ¥
- æ”¶è—å’Œç½®é¡¶åŠŸèƒ½
- Notioné£æ ¼çš„ç°ä»£åŒ–UI

### 1.2 é¡¹ç›®ç›®æ ‡

å°†ç¬”è®°ç³»ç»Ÿå‡çº§ä¸ºåŠŸèƒ½å®Œå–„çš„"ç¬¬äºŒå¤§è„‘"å·¥å…·ï¼Œæ”¯æŒï¼š
1. **å¯Œåª’ä½“å†…å®¹ç®¡ç†**ï¼šå›¾ç‰‡ã€PDFã€Wordç­‰é™„ä»¶ä¸Šä¼ å’Œé¢„è§ˆ
2. **çµæ´»ç»„ç»‡ç»“æ„**ï¼šæ–‡ä»¶å¤¹å±‚çº§ + æ ‡ç­¾ + æ”¶è—/ç½®é¡¶
3. **çŸ¥è¯†ç½‘ç»œåŒ–**ï¼šWikiåŒå‘é“¾æ¥ + å…³ç³»å›¾è°±å¯è§†åŒ–
4. **æ•ˆç‡æå‡**ï¼šç¬”è®°æ¨¡æ¿ã€æœç´¢å†å²ã€å…³é”®è¯é«˜äº®
5. **è§†è§‰å‡çº§**ï¼šNotioné£æ ¼æ‰å¹³åŒ–è®¾è®¡ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### 1.3 æ ¸å¿ƒåŸåˆ™

- âœ… **æ¸è¿›å¢å¼º**ï¼šåˆ†è¿­ä»£å®æ–½ï¼Œæ¯ä¸ªè¿­ä»£ç‹¬ç«‹å¯ç”¨
- âœ… **é›¶ç ´å**ï¼šä¸å½±å“ç°æœ‰ç¬”è®°æ•°æ®å’ŒåŠŸèƒ½
- âœ… **æ€§èƒ½ä¼˜å…ˆ**ï¼šå¤§æ–‡ä»¶åˆ†å—ä¸Šä¼ ï¼Œå›¾ç‰‡å‹ç¼©å­˜å‚¨
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šå®æ—¶ä¿å­˜ã€æ‹–æ‹½æ“ä½œã€å¿«æ·é”®æ”¯æŒ

---

## 2. éœ€æ±‚åˆ†æ

### 2.1 åŠŸèƒ½éœ€æ±‚

#### 2.1.1 ç¼–è¾‘å™¨å¢å¼º
| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| å›¾ç‰‡ä¸Šä¼  | æ”¯æŒç²˜è´´/æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ï¼Œä¿å­˜åˆ°æœåŠ¡å™¨ | P0 |
| é™„ä»¶ç®¡ç† | æ”¯æŒPDF/Word/Excelç­‰æ–‡ä»¶ä¸Šä¼  | P0 |
| é™„ä»¶åˆ—è¡¨ | æ˜¾ç¤ºç¬”è®°æ‰€æœ‰é™„ä»¶ï¼Œæ”¯æŒä¸‹è½½/åˆ é™¤ | P0 |
| Emojié€‰æ‹©å™¨ | ä¸ºç¬”è®°é€‰æ‹©emojiå›¾æ ‡ | P1 |
| å°é¢å›¾è®¾ç½® | ä¸Šä¼ æˆ–è®¾ç½®URLä½œä¸ºç¬”è®°å°é¢ | P1 |

#### 2.1.2 ç»„ç»‡ç»“æ„
| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| æ–‡ä»¶å¤¹å±‚çº§ | ç¬”è®°æ”¯æŒçˆ¶å­å…³ç³»ï¼Œæ„å»ºæ ‘çŠ¶ç»“æ„ | P1 |
| æ”¶è—åŠŸèƒ½ | æ ‡è®°é‡è¦ç¬”è®°ä¸ºæ”¶è— | P0 |
| ç½®é¡¶åŠŸèƒ½ | ç½®é¡¶ç¬”è®°å›ºå®šåœ¨åˆ—è¡¨é¡¶éƒ¨ | P0 |
| æ‹–æ‹½æ’åº | æ‹–æ‹½ç¬”è®°åˆ°æ–‡ä»¶å¤¹ | P2 |

#### 2.1.3 é“¾æ¥ç³»ç»Ÿ
| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| Wikié“¾æ¥è¾“å…¥ | `[[ç¬”è®°æ ‡é¢˜]]`è¯­æ³•åˆ›å»ºé“¾æ¥ | P1 |
| åå‘é“¾æ¥ | æ˜¾ç¤ºå¼•ç”¨å½“å‰ç¬”è®°çš„å…¶ä»–ç¬”è®° | P1 |
| é“¾æ¥é¢„è§ˆ | Hoveræ˜¾ç¤ºé“¾æ¥ç¬”è®°é¢„è§ˆ | P2 |
| å…³ç³»å›¾è°± | EChartså¯è§†åŒ–ç¬”è®°ç½‘ç»œ | P2 |

#### 2.1.4 æœç´¢å¢å¼º
| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| å…³é”®è¯é«˜äº® | æœç´¢ç»“æœä¸­é«˜äº®åŒ¹é…æ–‡æœ¬ | P0 |
| æœç´¢å†å² | è®°å½•æœ€è¿‘æœç´¢ï¼Œå¿«é€Ÿé‡ç”¨ | P0 |
| å…¨æ–‡æœç´¢ | æœç´¢ç¬”è®°å†…å®¹ï¼Œæ˜¾ç¤ºåŒ¹é…ç‰‡æ®µ | P1 |
| æ ‡ç­¾äº‘ | æŒ‰æ ‡ç­¾ä½¿ç”¨é¢‘ç‡æ˜¾ç¤ºæ ‡ç­¾äº‘ | P2 |

#### 2.1.5 æ¨¡æ¿ç³»ç»Ÿ
| åŠŸèƒ½ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| é¢„è®¾æ¨¡æ¿ | ä¼šè®®è®°å½•ã€è¯»ä¹¦ç¬”è®°ç­‰å¸¸ç”¨æ¨¡æ¿ | P1 |
| è‡ªå®šä¹‰æ¨¡æ¿ | ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†è‡ªå·±çš„æ¨¡æ¿ | P2 |
| æ¨¡æ¿å˜é‡ | æ”¯æŒ`{{date}}`ç­‰åŠ¨æ€å˜é‡ | P2 |

### 2.2 éåŠŸèƒ½éœ€æ±‚

| ç±»å‹ | éœ€æ±‚ | æŒ‡æ ‡ |
|------|------|------|
| æ€§èƒ½ | ç¬”è®°åˆ—è¡¨åŠ è½½æ—¶é—´ | < 500ms (100æ¡ç¬”è®°) |
| æ€§èƒ½ | é™„ä»¶ä¸Šä¼ é€Ÿåº¦ | æ”¯æŒ10MBä»¥å†…æ–‡ä»¶ |
| å®‰å…¨ | æ–‡ä»¶ç±»å‹æ ¡éªŒ | ç™½åå•æœºåˆ¶ï¼Œé˜²æ­¢æ¶æ„æ–‡ä»¶ |
| å…¼å®¹æ€§ | æµè§ˆå™¨æ”¯æŒ | Chrome/Edge/Firefox/Safariæœ€æ–°2ä¸ªç‰ˆæœ¬ |
| å¯ç”¨æ€§ | æ•°æ®æŒä¹…åŒ– | è‡ªåŠ¨ä¿å­˜è‰ç¨¿ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤± |

---

## 3. æŠ€æœ¯æ¶æ„

### 3.1 æŠ€æœ¯æ ˆ

#### 3.1.1 å‰ç«¯
```
æ¡†æ¶: Vue 3.4 (Composition API)
UIåº“: Element Plus 2.5
ç¼–è¾‘å™¨: md-editor-v3 6.1
çŠ¶æ€ç®¡ç†: Pinia 2.1
è·¯ç”±: Vue Router 4.2
å›¾è¡¨: ECharts 6.0
æ ·å¼: SCSS (sass-embedded)
æ„å»º: Vite 5.0 + TypeScript 5.3
```

#### 3.1.2 åç«¯
```
æ¡†æ¶: FastAPI (Python 3.10+)
ORM: SQLAlchemy
æ•°æ®åº“: SQLite
æ–‡ä»¶å­˜å‚¨: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (backend/uploads/)
```

### 3.2 æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯ (Vue 3)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NotesView    â”‚ NoteEditor   â”‚ FolderTree   â”‚ Backlinks  â”‚
â”‚ (ç¬”è®°åˆ—è¡¨)    â”‚ (ç¼–è¾‘å™¨)      â”‚ (æ–‡ä»¶å¤¹æ ‘)    â”‚ (åå‘é“¾æ¥)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ REST API
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚         FastAPI Backend                 â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ notes.py     â”‚ attachments  â”‚ templates â”‚
       â”‚ (ç¬”è®°CRUD)    â”‚ (é™„ä»¶ç®¡ç†)    â”‚ (æ¨¡æ¿)     â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚      SQLite Database    â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ notes                   â”‚
       â”‚ note_attachments        â”‚
       â”‚ note_templates          â”‚
       â”‚ note_links              â”‚
       â”‚ search_history          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   File System Storage   â”‚
       â”‚   backend/uploads/      â”‚
       â”‚   â”œâ”€â”€ images/           â”‚
       â”‚   â”œâ”€â”€ attachments/      â”‚
       â”‚   â””â”€â”€ covers/           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ•°æ®åº“è®¾è®¡

### 4.1 Schemaå˜æ›´

#### 4.1.1 notesè¡¨æ‰©å±• (è¿­ä»£1)
```sql
ALTER TABLE notes ADD COLUMN:
  cover_image VARCHAR(2048) NULL,        -- å°é¢å›¾URL
  emoji VARCHAR(10) NULL,                 -- emojiå›¾æ ‡ (å¦‚: ğŸ“)
  is_pinned BOOLEAN DEFAULT FALSE,        -- æ˜¯å¦ç½®é¡¶
  is_favorited BOOLEAN DEFAULT FALSE,     -- æ˜¯å¦æ”¶è—
  view_count INTEGER DEFAULT 0,           -- é˜…è¯»æ¬¡æ•°
  sort_order INTEGER DEFAULT 0;           -- è‡ªå®šä¹‰æ’åºæƒé‡
```

#### 4.1.2 notesè¡¨æ‰©å±• (è¿­ä»£2)
```sql
ALTER TABLE notes ADD COLUMN:
  parent_note_id INTEGER NULL,           -- çˆ¶ç¬”è®°ID (æ–‡ä»¶å¤¹å±‚çº§)
  template_id INTEGER NULL,               -- æ¨¡æ¿ID
  FOREIGN KEY (parent_note_id) REFERENCES notes(id) ON DELETE SET NULL,
  FOREIGN KEY (template_id) REFERENCES note_templates(id) ON DELETE SET NULL;
```

#### 4.1.3 æ–°è¡¨: note_attachments (è¿­ä»£2)
```sql
CREATE TABLE note_attachments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  note_id INTEGER NOT NULL,
  filename VARCHAR(255) NOT NULL,        -- åŸå§‹æ–‡ä»¶å
  filepath VARCHAR(2048) NOT NULL,       -- å­˜å‚¨è·¯å¾„
  filesize INTEGER NOT NULL,             -- æ–‡ä»¶å¤§å°(bytes)
  mimetype VARCHAR(100) NOT NULL,        -- MIMEç±»å‹
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (note_id) REFERENCES notes(id) ON DELETE CASCADE
);

CREATE INDEX idx_note_attachments_note_id ON note_attachments(note_id);
```

#### 4.1.4 æ–°è¡¨: note_templates (è¿­ä»£2)
```sql
CREATE TABLE note_templates (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name VARCHAR(255) NOT NULL,            -- æ¨¡æ¿åç§°
  description TEXT,                       -- æ¨¡æ¿æè¿°
  content_template TEXT NOT NULL,        -- æ¨¡æ¿å†…å®¹(Markdown)
  icon VARCHAR(10),                       -- å›¾æ ‡(emoji)
  category VARCHAR(50),                   -- åˆ†ç±»(ä¼šè®®/è¯»ä¹¦/æ—¥è®°ç­‰)
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 4.1.5 æ–°è¡¨: note_links (è¿­ä»£3)
```sql
CREATE TABLE note_links (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  source_note_id INTEGER NOT NULL,       -- æ¥æºç¬”è®°ID
  target_note_id INTEGER NOT NULL,       -- ç›®æ ‡ç¬”è®°ID
  link_text VARCHAR(500),                 -- é“¾æ¥æ–‡æœ¬
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (source_note_id) REFERENCES notes(id) ON DELETE CASCADE,
  FOREIGN KEY (target_note_id) REFERENCES notes(id) ON DELETE CASCADE,
  UNIQUE(source_note_id, target_note_id)
);

CREATE INDEX idx_note_links_source ON note_links(source_note_id);
CREATE INDEX idx_note_links_target ON note_links(target_note_id);
```

#### 4.1.6 æ–°è¡¨: search_history (è¿­ä»£1)
```sql
CREATE TABLE search_history (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  query_text VARCHAR(500) NOT NULL,      -- æœç´¢å…³é”®è¯
  result_count INTEGER DEFAULT 0,        -- ç»“æœæ•°é‡
  timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_search_history_timestamp ON search_history(timestamp DESC);
```

### 4.2 æ•°æ®è¿ç§»è„šæœ¬

```python
# backend/migrations/add_note_enhancements.py
from sqlalchemy import text

def upgrade_iteration_1(db_session):
    """è¿­ä»£1: æ ¸å¿ƒå¢å¼ºå­—æ®µ"""
    db_session.execute(text("""
        ALTER TABLE notes ADD COLUMN cover_image VARCHAR(2048);
        ALTER TABLE notes ADD COLUMN emoji VARCHAR(10);
        ALTER TABLE notes ADD COLUMN is_pinned BOOLEAN DEFAULT FALSE;
        ALTER TABLE notes ADD COLUMN is_favorited BOOLEAN DEFAULT FALSE;
        ALTER TABLE notes ADD COLUMN view_count INTEGER DEFAULT 0;
        ALTER TABLE notes ADD COLUMN sort_order INTEGER DEFAULT 0;
    """))

    db_session.execute(text("""
        CREATE TABLE search_history (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            query_text VARCHAR(500) NOT NULL,
            result_count INTEGER DEFAULT 0,
            timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
        );
        CREATE INDEX idx_search_history_timestamp ON search_history(timestamp DESC);
    """))

    db_session.commit()

def upgrade_iteration_2(db_session):
    """è¿­ä»£2: é™„ä»¶å’Œæ¨¡æ¿"""
    # ... (åˆ›å»ºnote_attachmentså’Œnote_templatesè¡¨)
    pass

def upgrade_iteration_3(db_session):
    """è¿­ä»£3: åŒå‘é“¾æ¥å’Œæ–‡ä»¶å¤¹"""
    # ... (åˆ›å»ºnote_linksè¡¨ï¼Œæ·»åŠ parent_note_idå­—æ®µ)
    pass
```

---

## 5. APIè®¾è®¡

### 5.1 è¿­ä»£1: æ ¸å¿ƒå¢å¼ºAPI

#### 5.1.1 ç½®é¡¶/æ”¶è—
```
PUT /api/notes/{note_id}/pin
Request: { "pinned": true }
Response: { "id": 1, "is_pinned": true, ... }

PUT /api/notes/{note_id}/favorite
Request: { "favorited": true }
Response: { "id": 1, "is_favorited": true, ... }
```

#### 5.1.2 æœç´¢å†å²
```
GET /api/notes/search/history?limit=10
Response: [
  { "query_text": "Pythonå­¦ä¹ ", "result_count": 5, "timestamp": "2025-11-19T10:00:00" },
  ...
]

POST /api/notes/search/highlight
Request: { "query": "Python", "limit": 10 }
Response: [
  {
    "note": { ... },
    "highlights": [
      { "text": "Pythonæ˜¯ä¸€é—¨...", "match_start": 0, "match_end": 6 }
    ]
  }
]
```

### 5.2 è¿­ä»£2: é™„ä»¶å’Œæ¨¡æ¿API

#### 5.2.1 é™„ä»¶ç®¡ç†
```
POST /api/notes/upload-attachment
Content-Type: multipart/form-data
Request: { "file": <binary>, "note_id": 1 }
Response: {
  "id": 1,
  "filename": "document.pdf",
  "filepath": "/uploads/attachments/2025/11/xxx.pdf",
  "filesize": 1024000,
  "mimetype": "application/pdf"
}

GET /api/notes/{note_id}/attachments
Response: [ { "id": 1, "filename": "...", ... }, ... ]

DELETE /api/notes/attachments/{attachment_id}
Response: 204 No Content
```

#### 5.2.2 æ¨¡æ¿ç®¡ç†
```
GET /api/notes/templates/
Response: [ { "id": 1, "name": "ä¼šè®®è®°å½•", "icon": "ğŸ“‹", ... }, ... ]

POST /api/notes/from-template/{template_id}
Request: { "title": "2025-11-19 å›¢é˜Ÿä¼šè®®" }
Response: { "id": 10, "title": "...", "content": "<æ¨¡æ¿å†…å®¹>" }
```

### 5.3 è¿­ä»£3: é“¾æ¥å’Œæ–‡ä»¶å¤¹API

#### 5.3.1 åŒå‘é“¾æ¥
```
POST /api/notes/{note_id}/add-link
Request: { "target_note_id": 5, "link_text": "ç›¸å…³ç¬”è®°" }
Response: { "id": 1, "source_note_id": 1, "target_note_id": 5 }

GET /api/notes/{note_id}/backlinks
Response: [
  { "source_note": { "id": 3, "title": "..." }, "link_text": "..." }
]
```

#### 5.3.2 æ–‡ä»¶å¤¹æ“ä½œ
```
PUT /api/notes/{note_id}/move
Request: { "parent_note_id": 2 }
Response: { "id": 1, "parent_note_id": 2, ... }
```

---

## 6. å‰ç«¯ç»„ä»¶è®¾è®¡

### 6.1 ç»„ä»¶å±‚çº§ç»“æ„

```
NotesView.vue (ä¸»è§†å›¾)
â”œâ”€â”€ NoteFolderTree.vue (å·¦ä¾§è¾¹æ  - æ–‡ä»¶å¤¹æ ‘)
â”‚   â””â”€â”€ FolderNode.vue (é€’å½’èŠ‚ç‚¹)
â”œâ”€â”€ NoteFilters.vue (æœç´¢å’Œç­›é€‰æ )
â”‚   â””â”€â”€ SearchHistoryDropdown.vue (æœç´¢å†å²)
â”œâ”€â”€ NoteGrid.vue (ç½‘æ ¼è§†å›¾)
â”‚   â””â”€â”€ NoteCard.vue (ç¬”è®°å¡ç‰‡ - Notioné£æ ¼)
â”œâ”€â”€ NoteList.vue (åˆ—è¡¨è§†å›¾)
â”‚   â””â”€â”€ NoteListItem.vue (åˆ—è¡¨é¡¹)
â””â”€â”€ NoteEditor.vue (ç¼–è¾‘å¯¹è¯æ¡†)
    â”œâ”€â”€ EmojiPicker.vue (emojié€‰æ‹©å™¨)
    â”œâ”€â”€ CoverImageUploader.vue (å°é¢å›¾ä¸Šä¼ )
    â”œâ”€â”€ AttachmentUploader.vue (é™„ä»¶ä¸Šä¼ åŒº)
    â”œâ”€â”€ AttachmentList.vue (é™„ä»¶åˆ—è¡¨)
    â”œâ”€â”€ TemplateSelector.vue (æ¨¡æ¿é€‰æ‹©å™¨)
    â””â”€â”€ WikiLinkInput.vue (Wikié“¾æ¥è¾“å…¥)
```

### 6.2 æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 6.2.1 NoteCard.vue (Notioné£æ ¼)

**è§†è§‰è®¾è®¡**:
```vue
<template>
  <div class="note-card-notion" :class="{ 'is-pinned': note.is_pinned }">
    <!-- å°é¢å›¾æˆ–æ¸å˜èƒŒæ™¯ -->
    <div class="card-cover" :style="coverStyle">
      <span v-if="note.emoji" class="card-emoji">{{ note.emoji }}</span>
    </div>

    <!-- å†…å®¹åŒº -->
    <div class="card-body">
      <!-- æ ‡é¢˜ -->
      <h4 class="card-title">
        <span v-if="note.is_pinned" class="pin-icon">ğŸ“Œ</span>
        {{ note.title }}
        <span v-if="note.is_favorited" class="favorite-icon">â­</span>
      </h4>

      <!-- å†…å®¹é¢„è§ˆ (3è¡Œ) -->
      <p class="card-preview">{{ truncatedContent }}</p>

      <!-- åº•éƒ¨å…ƒä¿¡æ¯ -->
      <div class="card-footer">
        <el-tag v-if="note.project" size="small" :color="note.project.color">
          {{ note.project.name }}
        </el-tag>
        <span class="view-count">ğŸ‘ {{ note.view_count }}</span>
        <span class="update-time">{{ formatTime(note.updated_at) }}</span>
      </div>
    </div>
  </div>
</template>

<style scoped lang="scss">
.note-card-notion {
  border: 1px solid transparent;
  border-radius: 8px;
  background: white;
  overflow: hidden;
  transition: all 0.2s ease;
  cursor: pointer;

  &:hover {
    border-color: #e3e2e0;
    background-color: #f7f6f3;
    transform: translateY(-2px);
  }

  &.is-pinned {
    border-color: #667eea;
    background: linear-gradient(135deg, #f5f7fa 0%, #f0f2ff 100%);
  }
}

.card-cover {
  height: 120px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;

  .card-emoji {
    font-size: 48px;
  }
}

.card-body {
  padding: 16px;
}

.card-title {
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 8px 0;
  display: flex;
  align-items: center;
  gap: 4px;
}

.card-preview {
  font-size: 14px;
  color: #606266;
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.card-footer {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 12px;
  font-size: 12px;
  color: #909399;
}
</style>
```

#### 6.2.2 AttachmentUploader.vue

```vue
<template>
  <div class="attachment-uploader">
    <el-upload
      ref="uploadRef"
      drag
      :auto-upload="false"
      :on-change="handleFileChange"
      :file-list="fileList"
      multiple
    >
      <el-icon class="upload-icon"><UploadFilled /></el-icon>
      <div class="upload-text">æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
      <div class="upload-hint">æ”¯æŒ PDF, Word, Excel, å›¾ç‰‡ç­‰æ–‡ä»¶</div>
    </el-upload>

    <!-- é™„ä»¶åˆ—è¡¨ -->
    <div v-if="attachments.length > 0" class="attachment-list">
      <div v-for="file in attachments" :key="file.id" class="attachment-item">
        <el-icon><Document /></el-icon>
        <span class="filename">{{ file.filename }}</span>
        <span class="filesize">{{ formatFileSize(file.filesize) }}</span>
        <el-button-group size="small">
          <el-button @click="downloadFile(file)">ä¸‹è½½</el-button>
          <el-button type="danger" @click="deleteFile(file)">åˆ é™¤</el-button>
        </el-button-group>
      </div>
    </div>
  </div>
</template>
```

#### 6.2.3 WikiLinkInput.vue

```vue
<template>
  <div class="wiki-link-input">
    <!-- åœ¨MdEditorä¸­ç›‘å¬è¾“å…¥ -->
    <!-- å½“æ£€æµ‹åˆ° [[ æ—¶ï¼Œå¼¹å‡ºç¬”è®°æœç´¢ä¸‹æ‹‰æ¡† -->
    <el-autocomplete
      v-model="linkText"
      :fetch-suggestions="searchNotes"
      placeholder="è¾“å…¥ç¬”è®°æ ‡é¢˜..."
      @select="handleSelect"
    >
      <template #default="{ item }">
        <div class="link-suggestion">
          <span class="emoji">{{ item.emoji }}</span>
          <span class="title">{{ item.title }}</span>
        </div>
      </template>
    </el-autocomplete>
  </div>
</template>

<script setup lang="ts">
// å½“ç”¨æˆ·è¾“å…¥ [[  æ—¶è§¦å‘
// å®æ—¶æœç´¢ç¬”è®°æ ‡é¢˜
// é€‰ä¸­åæ’å…¥ [[ç¬”è®°æ ‡é¢˜]] é“¾æ¥
</script>
```

### 6.3 çŠ¶æ€ç®¡ç† (Pinia Store)

```typescript
// stores/noteStore.ts æ‰©å±•
export const useNoteStore = defineStore('note', () => {
  // æ–°å¢çŠ¶æ€
  const pinnedNotes = computed(() =>
    notes.value.filter(n => n.is_pinned).sort((a, b) => b.sort_order - a.sort_order)
  )
  const favoritedNotes = computed(() =>
    notes.value.filter(n => n.is_favorited)
  )
  const searchHistory = ref<string[]>([])

  // æ–°å¢actions
  async function togglePin(noteId: number, pinned: boolean) {
    await apiClient.put(`/notes/${noteId}/pin`, { pinned })
    await fetchNotes()
  }

  async function toggleFavorite(noteId: number, favorited: boolean) {
    await apiClient.put(`/notes/${noteId}/favorite`, { favorited })
    await fetchNotes()
  }

  async function uploadAttachment(noteId: number, file: File) {
    const formData = new FormData()
    formData.append('file', file)
    formData.append('note_id', String(noteId))
    const response = await apiClient.post('/notes/upload-attachment', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
    return response.data
  }

  async function fetchSearchHistory() {
    const response = await apiClient.get('/notes/search/history', { params: { limit: 10 } })
    searchHistory.value = response.data.map(h => h.query_text)
  }

  // ...
})
```

---

## 7. å®æ–½è®¡åˆ’

### 7.1 è¿­ä»£1: æ ¸å¿ƒå¢å¼º (2å¤©)

**Day 1: åç«¯ + æ•°æ®åº“**
- [ ] æ•°æ®åº“è¿ç§»è„šæœ¬ (notesè¡¨æ‰©å±• + search_historyè¡¨)
- [ ] APIç«¯ç‚¹: ç½®é¡¶/æ”¶è—/æœç´¢å†å²/æœç´¢é«˜äº®
- [ ] Pydantic schemaæ›´æ–°
- [ ] å•å…ƒæµ‹è¯•

**Day 2: å‰ç«¯**
- [ ] NoteCard.vue Notioné£æ ¼é‡æ„
- [ ] NotesView.vue æœç´¢å¢å¼º (å†å²ä¸‹æ‹‰ã€å…³é”®è¯é«˜äº®)
- [ ] å¿«é€Ÿç­›é€‰æŒ‰é’® (ç½®é¡¶/æ”¶è—/æœ€è¿‘)
- [ ] æ ·å¼ç³»ç»Ÿæ‰©å±• (Notioné£æ ¼å˜é‡)
- [ ] é›†æˆæµ‹è¯•

### 7.2 è¿­ä»£2: é™„ä»¶ + æ¨¡æ¿ (1.5å¤©)

**Day 3: åç«¯**
- [ ] æ•°æ®åº“è¿ç§» (note_attachments + note_templatesè¡¨)
- [ ] æ–‡ä»¶ä¸Šä¼ API (æ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹)
- [ ] æ¨¡æ¿CRUD API
- [ ] æ–‡ä»¶å­˜å‚¨ç›®å½•ç»“æ„ (backend/uploads/)

**Day 4 ä¸Šåˆ: å‰ç«¯**
- [ ] AttachmentUploader.vue ç»„ä»¶
- [ ] AttachmentList.vue ç»„ä»¶
- [ ] TemplateSelector.vue ç»„ä»¶
- [ ] NoteEditor.vue é›†æˆé™„ä»¶å’Œæ¨¡æ¿åŠŸèƒ½

### 7.3 è¿­ä»£3: åŒå‘é“¾æ¥ + æ–‡ä»¶å¤¹ (1.5å¤©)

**Day 4 ä¸‹åˆ: åç«¯**
- [ ] æ•°æ®åº“è¿ç§» (note_linksè¡¨ + parent_note_idå­—æ®µ)
- [ ] åŒå‘é“¾æ¥API (åˆ›å»ºé“¾æ¥ã€åå‘é“¾æ¥)
- [ ] æ–‡ä»¶å¤¹æ“ä½œAPI

**Day 5: å‰ç«¯**
- [ ] NoteFolderTree.vue ç»„ä»¶ (é€’å½’æ ‘ç»“æ„)
- [ ] WikiLinkInput.vue ç»„ä»¶
- [ ] NoteBacklinks.vue ç»„ä»¶
- [ ] æ‹–æ‹½åŠŸèƒ½é›†æˆ
- [ ] (å¯é€‰) NoteGraph.vue å…³ç³»å›¾è°±

### 7.4 æµ‹è¯•å’Œä¼˜åŒ– (0.5å¤©)

**Day 5 ä¸‹åˆ**
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ– (å¤§æ–‡ä»¶ä¸Šä¼ ã€å›¾ç‰‡å‹ç¼©)
- [ ] Bugä¿®å¤
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–

---

## 8. é£é™©è¯„ä¼°

### 8.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| å¤§æ–‡ä»¶ä¸Šä¼ å¯¼è‡´æœåŠ¡å™¨å‹åŠ› | é«˜ | ä¸­ | é™åˆ¶å•æ–‡ä»¶10MBï¼Œåˆ†å—ä¸Šä¼  |
| åŒå‘é“¾æ¥è§£ææ€§èƒ½é—®é¢˜ | ä¸­ | ä½ | ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢ï¼Œé™åˆ¶é€’å½’æ·±åº¦ |
| æ–‡ä»¶å¤¹åµŒå¥—å±‚çº§è¿‡æ·± | ä¸­ | ä½ | é™åˆ¶æœ€å¤§å±‚çº§ä¸º5å±‚ |
| æ—§æ•°æ®å…¼å®¹æ€§é—®é¢˜ | é«˜ | ä½ | è¿ç§»è„šæœ¬å……åˆ†æµ‹è¯•ï¼Œæä¾›å›æ»šæ–¹æ¡ˆ |

### 8.2 ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | åº”å¯¹æªæ–½ |
|------|------|------|----------|
| ç”¨æˆ·å­¦ä¹ æˆæœ¬é«˜ | ä¸­ | ä¸­ | æä¾›å¼•å¯¼æ•™ç¨‹ï¼Œæ¸è¿›å¼æš´éœ²åŠŸèƒ½ |
| åŠŸèƒ½è¿‡äºå¤æ‚å½±å“æ€§èƒ½ | ä¸­ | ä½ | æŒ‰éœ€åŠ è½½ï¼Œæ‡’åŠ è½½ç»„ä»¶ |
| ç§»åŠ¨ç«¯é€‚é…é—®é¢˜ | ä½ | ä¸­ | å“åº”å¼è®¾è®¡ï¼Œä¼˜å…ˆä¿è¯PCç«¯ä½“éªŒ |

---

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 å•å…ƒæµ‹è¯•

**åç«¯æµ‹è¯• (pytest)**
```python
# tests/test_notes_enhancements.py
def test_note_pin(client, db_session):
    """æµ‹è¯•ç¬”è®°ç½®é¡¶åŠŸèƒ½"""
    note = create_test_note(db_session)
    response = client.put(f'/api/notes/{note.id}/pin', json={'pinned': True})
    assert response.status_code == 200
    assert response.json()['is_pinned'] == True

def test_attachment_upload(client, db_session):
    """æµ‹è¯•é™„ä»¶ä¸Šä¼ """
    note = create_test_note(db_session)
    file = ('test.pdf', b'PDF content', 'application/pdf')
    response = client.post(
        '/api/notes/upload-attachment',
        files={'file': file},
        data={'note_id': note.id}
    )
    assert response.status_code == 200
    assert 'filepath' in response.json()
```

**å‰ç«¯æµ‹è¯• (Vitest)**
```typescript
// tests/components/NoteCard.spec.ts
describe('NoteCard.vue', () => {
  it('æ˜¾ç¤ºç½®é¡¶å›¾æ ‡', () => {
    const note = { ...mockNote, is_pinned: true }
    const wrapper = mount(NoteCard, { props: { note } })
    expect(wrapper.find('.pin-icon').exists()).toBe(true)
  })

  it('hoveræ—¶åº”ç”¨Notioné£æ ¼', async () => {
    const wrapper = mount(NoteCard, { props: { note: mockNote } })
    await wrapper.trigger('mouseenter')
    expect(wrapper.classes()).toContain('hover')
  })
})
```

### 9.2 é›†æˆæµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
1. âœ… åˆ›å»ºç¬”è®° â†’ ä¸Šä¼ é™„ä»¶ â†’ ä¸‹è½½é™„ä»¶ â†’ åˆ é™¤é™„ä»¶
2. âœ… åˆ›å»ºç¬”è®° â†’ ç½®é¡¶ â†’ å–æ¶ˆç½®é¡¶
3. âœ… æœç´¢ç¬”è®° â†’ æŸ¥çœ‹æœç´¢å†å² â†’ é‡ç”¨å†å²æœç´¢
4. âœ… åˆ›å»ºæ–‡ä»¶å¤¹ â†’ æ‹–æ‹½ç¬”è®°åˆ°æ–‡ä»¶å¤¹ â†’ å±•å¼€/æŠ˜å 
5. âœ… åˆ›å»ºç¬”è®°A â†’ åœ¨ç¬”è®°Bä¸­åˆ›å»ºé“¾æ¥ â†’ æŸ¥çœ‹ç¬”è®°Açš„åå‘é“¾æ¥

### 9.3 æ€§èƒ½æµ‹è¯•

**æµ‹è¯•æŒ‡æ ‡**:
- 100æ¡ç¬”è®°åˆ—è¡¨åŠ è½½æ—¶é—´ < 500ms
- 1000æ¡ç¬”è®°åˆ—è¡¨åŠ è½½æ—¶é—´ < 2s
- 5MBå›¾ç‰‡ä¸Šä¼ æ—¶é—´ < 3s
- æœç´¢1000æ¡ç¬”è®°å“åº”æ—¶é—´ < 300ms

---

## 10. é™„å½•

### 10.1 æ–‡ä»¶å­˜å‚¨ç»“æ„

```
backend/
â””â”€â”€ uploads/
    â”œâ”€â”€ images/              # ç¬”è®°å†…å›¾ç‰‡
    â”‚   â””â”€â”€ 2025/
    â”‚       â””â”€â”€ 11/
    â”‚           â””â”€â”€ {uuid}.jpg
    â”œâ”€â”€ covers/              # ç¬”è®°å°é¢å›¾
    â”‚   â””â”€â”€ 2025/
    â”‚       â””â”€â”€ 11/
    â”‚           â””â”€â”€ {uuid}.jpg
    â””â”€â”€ attachments/         # é™„ä»¶
        â””â”€â”€ 2025/
            â””â”€â”€ 11/
                â””â”€â”€ {uuid}_{åŸæ–‡ä»¶å}.pdf
```

### 10.2 é¢„è®¾æ¨¡æ¿åˆ—è¡¨

| æ¨¡æ¿åç§° | å›¾æ ‡ | å†…å®¹ç»“æ„ |
|---------|------|----------|
| ä¼šè®®è®°å½• | ğŸ“‹ | ä¼šè®®ä¸»é¢˜ã€å‚ä¼šäººå‘˜ã€è®¨è®ºå†…å®¹ã€è¡ŒåŠ¨é¡¹ |
| è¯»ä¹¦ç¬”è®° | ğŸ“š | ä¹¦åã€ä½œè€…ã€æ ¸å¿ƒè§‚ç‚¹ã€ä¸ªäººæ„Ÿæ‚Ÿã€å¼•ç”¨ |
| å‘¨æŠ¥ | ğŸ“Š | æœ¬å‘¨å®Œæˆã€ä¸‹å‘¨è®¡åˆ’ã€é‡åˆ°é—®é¢˜ã€éœ€è¦æ”¯æŒ |
| æ—¥è®° | ğŸ“ | æ—¥æœŸã€å¤©æ°”ã€å¿ƒæƒ…ã€ä»Šæ—¥æ€»ç»“ã€æ˜æ—¥è®¡åˆ’ |
| é¡¹ç›®è®¡åˆ’ | ğŸ¯ | é¡¹ç›®ç›®æ ‡ã€é‡Œç¨‹ç¢‘ã€å…³é”®ä»»åŠ¡ã€é£é™©è¯„ä¼° |

### 10.3 å¿«æ·é”®è®¾è®¡

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| Ctrl + N | æ–°å»ºç¬”è®° | æ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡† |
| Ctrl + F | æœç´¢ç¬”è®° | èšç„¦æœç´¢æ¡† |
| Ctrl + P | ç½®é¡¶å½“å‰ç¬”è®° | å¿«é€Ÿç½®é¡¶ |
| Ctrl + B | æ”¶è—å½“å‰ç¬”è®° | å¿«é€Ÿæ”¶è— |
| [[ | Wikié“¾æ¥ | è§¦å‘ç¬”è®°æœç´¢ |
| Ctrl + / | æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ© | å¸®åŠ©é¢æ¿ |

---

## æ›´æ–°æ—¥å¿—

| æ—¥æœŸ | ç‰ˆæœ¬ | ä¿®æ”¹å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| 2025-11-19 | v1.0 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´è®¾è®¡æ–‡æ¡£ | Claude Code |

---

**æ–‡æ¡£ç»“æŸ**
