# é¡¹ç›®ï¼š"ä¸ªäººæˆé•¿æ“ä½œç³»ç»Ÿ" (Personal Growth OS) - åç«¯è¯¦ç»†è®¾è®¡æ–‡æ¡£

---

> **ğŸ“Œ å®æ–½çŠ¶æ€è¯´æ˜**
> - **å½“å‰å®ç°**: âœ… **å¤§éƒ¨åˆ†å·²å®ç°** - åŸºäºLangGraphçš„MVPç³»ç»Ÿ
> - **æŠ€æœ¯æ ˆ**: FastAPI + SQLite + ChromaDB + LangGraph
> - **å·²å®ç°æ ¸å¿ƒåŠŸèƒ½**:
>   - âœ… ä¸‰å±‚æ¶æ„ (API â†’ Service â†’ CRUD â†’ Database)
>   - âœ… Task Igniter Agent (LangGraph StateGraph)
>   - âœ… ä»»åŠ¡/ç¬”è®°/é¡¹ç›®CRUD
>   - âœ… é™„ä»¶ç®¡ç†å’Œç¬”è®°é“¾æ¥
>   - âœ… åŸºç¡€RAG (è¯­ä¹‰æœç´¢)
>   - âœ… æ—¥ç¨‹è¡¨å’Œä»»åŠ¡å»¶å
> - **ç›®æ ‡æ¶æ„**: Agnoæ¡†æ¶ (æœ¬æ–‡æ¡£éƒ¨åˆ†ç« èŠ‚æè¿°)
> - **è¿ç§»è®¡åˆ’**: è®¡åˆ’ä¸­ - å‡†å¤‡è¿ç§»åˆ°Agnoæ¡†æ¶
>
> **é‡è¦**: æœ¬æ–‡æ¡£æ··åˆæè¿°äº†å½“å‰å®ç°å’Œç›®æ ‡æ¶æ„ã€‚å…·ä½“ç« èŠ‚ä¼šæ ‡æ³¨å®æ–½çŠ¶æ€ (âœ…å·²å®ç°/â¸ï¸éƒ¨åˆ†å®ç°/âŒæœªå®ç°)ã€‚

---

## **ç¬¬ä¸€éƒ¨åˆ†ï¼šåç«¯è¯¦ç»†è®¾è®¡ (Backend Design)**

---

### **1. åç«¯æ•´ä½“è®¾è®¡ (Backend Architecture Overview)**

#### **1.1. æ ¸å¿ƒè®¾è®¡ç†å¿µ**

##### **1.1.1. ä¸‰å±‚æ¶æ„ (Three-Layer Architecture)**

åç«¯é‡‡ç”¨ç»å…¸çš„ä¸‰å±‚æ¶æ„è®¾è®¡ï¼Œç¡®ä¿èŒè´£æ¸…æ™°ã€æ˜“äºç»´æŠ¤å’Œæµ‹è¯•ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API Layer                      â”‚
â”‚          (è¯·æ±‚å¤„ç†ã€å‚æ•°éªŒè¯ã€å“åº”åºåˆ—åŒ–)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Service Layer                     â”‚
â”‚        (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€å¤æ‚æµç¨‹ç¼–æ’)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Data Access Layer (CRUD)              â”‚
â”‚         (æ•°æ®åº“æ“ä½œæŠ½è±¡ã€CRUDå°è£…)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è®¾è®¡åŸåˆ™**ï¼š
- **APIå±‚åº”è¯¥"è–„"**ï¼šåªè´Ÿè´£HTTPåè®®ç›¸å…³çš„å¤„ç†
- **æœåŠ¡å±‚åº”è¯¥"åš"**ï¼šåŒ…å«æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
- **æ•°æ®è®¿é—®å±‚åº”è¯¥"çº¯ç²¹"**ï¼šåªè´Ÿè´£æ•°æ®æŒä¹…åŒ–ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘

---

##### **1.1.2. Agenté©±åŠ¨æ¶æ„ (Agent-Driven Architecture)**

å¤æ‚çš„AIåŠŸèƒ½é€šè¿‡**Agno Agent**å®ç°å£°æ˜å¼é…ç½®çš„å¤šæ­¥éª¤å¤„ç†ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆé¿å…ï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ è°ƒç”¨LLM API â†’ è¿”å›ç»“æœ

Agno Agentæ–¹å¼ï¼ˆæ¨èï¼‰ï¼š
ç”¨æˆ·è¯·æ±‚ â†’ Agno Agentå£°æ˜å¼é…ç½® â†’ è‡ªåŠ¨ä¼šè¯/è®°å¿†/çŸ¥è¯†æ£€ç´¢ â†’ è¿”å›ç»“æœ
```

**Agno Agentæ ¸å¿ƒç‰¹æ€§**ï¼š
- **å£°æ˜å¼é…ç½®**: é€šè¿‡å‚æ•°é…ç½®è€Œéä»£ç ç¼–æ’
- **å†…ç½®åŠŸèƒ½**: User Memoriesã€Knowledgeã€Toolsè‡ªåŠ¨ç®¡ç†
- **è‡ªåŠ¨RAG**: é€šè¿‡`search_knowledge=True`è‡ªåŠ¨æ£€ç´¢ChromaDB
- **ä¼šè¯ç®¡ç†**: é€šè¿‡`session_id`è‡ªåŠ¨ä¿å­˜/æ¢å¤ä¼šè¯
- **Teamåä½œ**: å¤šAgentè‡ªåŠ¨åè°ƒï¼Œæ— éœ€æ‰‹åŠ¨ç¼–æ’

**è¯¦ç»†è®¾è®¡**: å‚è§ [Agentè¯¦ç»†è®¾è®¡.md](./Agentè¯¦ç»†è®¾è®¡.md)

---

##### **1.1.3. ä¸‰éƒ¨åˆ†å­˜å‚¨ç³»ç»Ÿ (Three-Part Storage System)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å­˜å‚¨ä¸‰å±‚æ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   SQLite    â”‚   â”‚  ChromaDB   â”‚   â”‚  Mem0    â”‚ â”‚
â”‚  â”‚             â”‚   â”‚             â”‚   â”‚          â”‚ â”‚
â”‚  â”‚ ç»“æ„åŒ–æ•°æ®   â”‚   â”‚  å‘é‡æ•°æ®åº“  â”‚   â”‚  è®°å¿†ç³»ç»Ÿ â”‚ â”‚
â”‚  â”‚ (äº‹å®è®°å¿†)  â”‚   â”‚ (çŸ¥è¯†è¯­æ–™åº“) â”‚   â”‚(é•¿æœŸè®°å¿†) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚  â€¢ ä»»åŠ¡ã€ç¬”è®°     â€¢ æ–‡æ¡£å‘é‡åŒ–      â€¢ å¯¹è¯å†å²     â”‚
â”‚  â€¢ é¡¹ç›®ã€æ ‡ç­¾     â€¢ è¯­ä¹‰æœç´¢        â€¢ ç”¨æˆ·åå¥½     â”‚
â”‚  â€¢ ç”¨æˆ·é…ç½®       â€¢ RAGæ£€ç´¢         â€¢ ä¸Šä¸‹æ–‡è®°å¿†   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### **1.2. æŠ€æœ¯æ ˆè¯´æ˜**

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|----------|
| **FastAPI** | 0.115.0 | Webæ¡†æ¶ | é«˜æ€§èƒ½ã€è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆã€ç±»å‹æç¤ºæ”¯æŒ |
| **Python** | 3.10+ | ç¼–ç¨‹è¯­è¨€ | AIç”Ÿæ€ä¸°å¯Œã€å¼€å‘æ•ˆç‡é«˜ |
| **Agno** | 0.3+ | AI Agentç¼–æ’ | å£°æ˜å¼é…ç½®ã€å†…ç½®è®°å¿†å’ŒçŸ¥è¯†ç®¡ç† |
| ~~**LangGraph**~~ | - | âŒ å·²ç§»é™¤ | - |
| ~~**LangChain**~~ | - | âŒ å·²ç§»é™¤ | - |
| **SQLite** | - | å…³ç³»æ•°æ®åº“ | è½»é‡çº§ã€æ— éœ€ç‹¬ç«‹æœåŠ¡ã€é€‚åˆMVP |
| **ChromaDB** | 0.5.18 | å‘é‡æ•°æ®åº“ | æ˜“ç”¨ã€æ”¯æŒæœ¬åœ°éƒ¨ç½²ã€RAGæ€§èƒ½å¥½ |
| ~~**Mem0**~~ | - | âŒ å·²ç§»é™¤ | ä½¿ç”¨Agnoå†…ç½®User Memoriesæ›¿ä»£ |
| **Pydantic** | 2.9.2 | æ•°æ®éªŒè¯ | ç±»å‹å®‰å…¨ã€è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ– |
| **SQLAlchemy** | 2.0.36 | ORM | æˆç†Ÿçš„ORMã€æ”¯æŒå¼‚æ­¥ |

**é‡è¦å˜æ›´** (ç›®æ ‡æ¶æ„):
- ğŸ¯ è®¡åˆ’è¿ç§»åˆ° **Agno** - è½»é‡çº§å£°æ˜å¼Agentæ¡†æ¶
- ğŸ¯ è®¡åˆ’ç§»é™¤ **LangGraph** å’Œ **LangChain** - Agnoç›´æ¥æ”¯æŒå¤šLLM
- ğŸ¯ è®¡åˆ’ç§»é™¤ **Mem0** - ä½¿ç”¨Agnoå†…ç½®User MemoriesåŠŸèƒ½
- âœ… Pythonç‰ˆæœ¬è¦æ±‚ä¸º3.10+

**å½“å‰å®ç°çŠ¶æ€**:
- âœ… ä½¿ç”¨ **LangGraph** (StateGraphæ¨¡å¼) - `task_igniter_agent.py`
- âœ… ä½¿ç”¨ **LangChain** (langchain-core, langchain-openai)
- âœ… ä½¿ç”¨ **Mem0** (`memory_service.py`)
- â¸ï¸ è¿ç§»åˆ°Agnoæ¡†æ¶å‡†å¤‡ä¸­

---

#### **1.3. ç›®å½•ä¸æ–‡ä»¶ç»„ç»‡ç»“æ„**

**å®é™…å®ç°çŠ¶æ€**: âœ… å·²å®ç° | â¸ï¸ éƒ¨åˆ†å®ç° | âŒ æœªå®ç°

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                      # âœ… FastAPIåº”ç”¨å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                         # âœ… APIå±‚
â”‚   â”‚   â”œâ”€â”€ deps.py                  # âŒ ä¾èµ–æ³¨å…¥ï¼ˆæœªå®ç°ç‹¬ç«‹æ–‡ä»¶ï¼‰
â”‚   â”‚   â””â”€â”€ endpoints/               # âœ… APIç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ tasks.py             # âœ… ä»»åŠ¡ç›¸å…³API
â”‚   â”‚       â”œâ”€â”€ notes.py             # âœ… ç¬”è®°ç›¸å…³API
â”‚   â”‚       â”œâ”€â”€ attachments.py       # âœ… é™„ä»¶ç®¡ç†APIï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚       â”œâ”€â”€ links.py             # âœ… ç¬”è®°é“¾æ¥APIï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚       â”œâ”€â”€ chat.py              # âŒ å¯¹è¯ç›¸å…³APIï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚       â”œâ”€â”€ review.py            # âŒ å¤ç›˜ç›¸å…³APIï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚       â””â”€â”€ projects.py          # âœ… é¡¹ç›®ç›¸å…³API
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                    # â¸ï¸ æœåŠ¡å±‚ï¼ˆéƒ¨åˆ†å®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ task_service.py          # âŒ ä»»åŠ¡ä¸šåŠ¡é€»è¾‘ï¼ˆæœªç‹¬ç«‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ note_service.py          # âŒ ç¬”è®°ä¸šåŠ¡é€»è¾‘ï¼ˆæœªç‹¬ç«‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ chat_service.py          # âŒ å¯¹è¯ä¸šåŠ¡é€»è¾‘ï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ review_service.py        # âŒ å¤ç›˜ä¸šåŠ¡é€»è¾‘ï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ vector_store.py          # âœ… ChromaDBå‘é‡å­˜å‚¨æœåŠ¡ï¼ˆå®é™…å­˜åœ¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ memory_service.py        # âœ… Mem0è®°å¿†æœåŠ¡ï¼ˆå®é™…å­˜åœ¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ file_storage.py          # âœ… æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æœåŠ¡ï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ chunking.py              # âœ… æ–‡æœ¬åˆ†å—æœåŠ¡ï¼ˆå·²å®ç°ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/                      # â¸ï¸ Agentå®šä¹‰ï¼ˆå½“å‰LangGraphï¼Œè®¡åˆ’è¿ç§»Agnoï¼‰
â”‚   â”‚   â”œâ”€â”€ task_igniter_agent.py    # âœ… ä»»åŠ¡å¯åŠ¨ä»ªå¼Agent (LangGraph StateGraph)
â”‚   â”‚   â”œâ”€â”€ review_coach_agent.py    # âŒ å¤ç›˜æ•™ç»ƒAgentï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ knowledge_retriever_agent.py  # âŒ çŸ¥è¯†æ£€ç´¢Agentï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ crud/                        # âœ… æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ base.py                  # âŒ åŸºç¡€CRUDç±»ï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚   â”œâ”€â”€ crud_task.py             # âœ… ä»»åŠ¡CRUDï¼ˆå®é™…æ–‡ä»¶åï¼‰
â”‚   â”‚   â”œâ”€â”€ crud_note.py             # âœ… ç¬”è®°CRUDï¼ˆå®é™…æ–‡ä»¶åï¼‰
â”‚   â”‚   â”œâ”€â”€ crud_project.py          # âœ… é¡¹ç›®CRUDï¼ˆå®é™…æ–‡ä»¶åï¼‰
â”‚   â”‚   â””â”€â”€ conversation.py          # âŒ å¯¹è¯CRUDï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                          # âœ… æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ base.py                  # âŒ Baseç±»å®šä¹‰ï¼ˆæœªå•ç‹¬æ–‡ä»¶ï¼‰
â”‚   â”‚   â”œâ”€â”€ database.py              # âœ… æ•°æ®åº“ä¼šè¯ç®¡ç†ï¼ˆå®é™…æ–‡ä»¶åï¼‰
â”‚   â”‚   â”œâ”€â”€ init_db.py               # âŒ æ•°æ®åº“åˆå§‹åŒ–ï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ models.py                # âœ… SQLAlchemyæ¨¡å‹ï¼ˆå•æ–‡ä»¶,éç›®å½•ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                     # âœ… Pydanticæ¨¡å‹ï¼ˆæ•°æ®éªŒè¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ task.py                  # âœ… ä»»åŠ¡Schema
â”‚   â”‚   â”œâ”€â”€ note.py                  # âœ… ç¬”è®°Schema
â”‚   â”‚   â”œâ”€â”€ project.py               # âœ… é¡¹ç›®Schema
â”‚   â”‚   â”œâ”€â”€ chat.py                  # âŒ å¯¹è¯Schemaï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚   â””â”€â”€ common.py                # âŒ é€šç”¨Schemaï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                        # âœ… æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py                # âœ… åº”ç”¨é…ç½®ï¼ˆSettingsï¼‰
â”‚   â”‚   â”œâ”€â”€ llm_factory.py           # âœ… LLMå·¥å‚æ¨¡å¼
â”‚   â”‚   â””â”€â”€ security.py              # âŒ å®‰å…¨ç›¸å…³ï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ integrations/                # âŒ å¤–éƒ¨é›†æˆï¼ˆæœªå®ç°ç›®å½•ï¼‰
â”‚   â”‚   â”œâ”€â”€ chroma_client.py         # âŒ ï¼ˆåŠŸèƒ½åœ¨services/vector_store.pyä¸­ï¼‰
â”‚   â”‚   â”œâ”€â”€ mem0_client.py           # âŒ ï¼ˆåŠŸèƒ½åœ¨services/memory_service.pyä¸­ï¼‰
â”‚   â”‚   â””â”€â”€ notification.py          # âŒ é€šçŸ¥æœåŠ¡ï¼ˆæœªå®ç°ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ utils/                       # âŒ å·¥å…·å‡½æ•°ï¼ˆç›®å½•ä¸å­˜åœ¨ï¼‰
â”‚       â”œâ”€â”€ logger.py                # âŒ
â”‚       â”œâ”€â”€ datetime_utils.py        # âŒ
â”‚       â””â”€â”€ text_processing.py       # âŒ
â”‚
â”œâ”€â”€ tests/                           # âœ… æµ‹è¯•è„šæœ¬ï¼ˆå®é™…å­˜åœ¨ï¼‰
â”‚   â”œâ”€â”€ legacy/                      # âœ… å†å²é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ run_tests.py             # âœ… è½»é‡çº§é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_integration.py      # âœ… ç»¼åˆç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ check_pending_tasks.py   # âœ… éªŒè¯å¾…åŠä»»åŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ check_scheduled_tasks.py # âœ… éªŒè¯æ—¥ç¨‹ä»»åŠ¡è¿‡æ»¤
â”‚   â”‚   â””â”€â”€ test_frontend_filter.py  # âœ… å‰ç«¯è¿‡æ»¤è¡Œä¸ºæµ‹è¯•
â”‚   â”œâ”€â”€ fixtures/                    # âœ… æµ‹è¯•æ•°æ®ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ create_test_data.py      # âœ… ç”Ÿæˆç¤ºä¾‹é¡¹ç›®å’Œä»»åŠ¡
â”‚   â”‚   â””â”€â”€ create_test_tasks.py     # âœ… ç”Ÿæˆæµ‹è¯•ä»»åŠ¡
â”‚   â””â”€â”€ README.md                    # âœ… æµ‹è¯•æ–‡æ¡£
â”‚
â”œâ”€â”€ alembic/                         # âŒ æ•°æ®åº“è¿ç§»ï¼ˆæœªå®ç°ï¼‰
â”œâ”€â”€ requirements.txt                 # âœ… ä¾èµ–åˆ—è¡¨
â””â”€â”€ .env.example                     # âœ… ç¯å¢ƒå˜é‡æ¨¡æ¿
```

**æ³¨æ„**:
- MVPé˜¶æ®µé‡‡ç”¨ç®€åŒ–æ¶æ„,éƒ¨åˆ†æœåŠ¡å±‚é€»è¾‘ç›´æ¥åœ¨APIå±‚å®ç°,æœªå»ºç«‹ç‹¬ç«‹serviceæ–‡ä»¶
- `backend/utils/` ç›®å½•ä¸å­˜åœ¨ï¼Œå·¥å…·è„šæœ¬å·²ç§»è‡³ `tests/fixtures/` å’Œ `tests/legacy/`
- æµ‹è¯•è„šæœ¬è¯¦è§ `tests/README.md`

---

### **2. æ•°æ®åº“è®¾è®¡ (Database Design)**

#### **2.1. SQLiteæ•°æ®åº“è®¾è®¡**

##### **2.1.1. ERå›¾æ¦‚è§ˆ**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  projects   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚   tasks     â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  note_tasks â”‚
â”‚             â”‚ 1    * â”‚             â”‚ *    * â”‚             â”‚
â”‚ â€¢ id        â”‚        â”‚ â€¢ id        â”‚        â”‚ â€¢ task_id   â”‚
â”‚ â€¢ name      â”‚        â”‚ â€¢ title     â”‚        â”‚ â€¢ note_id   â”‚
â”‚ â€¢ desc      â”‚        â”‚ â€¢ status    â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ created   â”‚        â”‚ â€¢ due_date  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â€¢ snooze_untilâ”‚             â”‚
                       â”‚ â€¢ project_idâ”‚               â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                              â”‚                      â”‚
                              â”‚ *                    â”‚ *
                              â–¼                      â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  subtasks   â”‚        â”‚    notes    â”‚
                       â”‚             â”‚        â”‚             â”‚
                       â”‚ â€¢ id        â”‚        â”‚ â€¢ id        â”‚
                       â”‚ â€¢ parent_id â”‚        â”‚ â€¢ title     â”‚
                       â”‚ â€¢ order     â”‚        â”‚ â€¢ content   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â€¢ source_urlâ”‚
                                             â”‚ â€¢ created   â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â”‚ *
                                                    â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚  note_tags  â”‚
                                             â”‚             â”‚
                                             â”‚ â€¢ note_id   â”‚
                                             â”‚ â€¢ tag_id    â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â”‚ *
                                                    â–¼
                                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                             â”‚    tags     â”‚
                                             â”‚             â”‚
                                             â”‚ â€¢ id        â”‚
                                             â”‚ â€¢ name      â”‚
                                             â”‚ â€¢ color     â”‚
                                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

##### **2.1.2. è¡¨ç»“æ„è¯¦ç»†è®¾è®¡**

**âš ï¸ å®é™…å®ç°ä¸è®¾è®¡å·®å¼‚**ï¼šå®é™…ä½¿ç”¨ `INTEGER` è‡ªå¢ä¸»é”®,éUUIDã€‚

**projectsè¡¨ï¼ˆé¡¹ç›®ï¼‰**ï¼š

| å­—æ®µ | ç±»å‹ï¼ˆè®¾è®¡ï¼‰ | å®é™…ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------------|---------|------|------|
| id | TEXT | **INTEGER** | PRIMARY KEY AUTOINCREMENT | âš ï¸ å®é™…ä½¿ç”¨è‡ªå¢ID |
| name | TEXT | String(255) | NOT NULL | é¡¹ç›®åç§° |
| description | TEXT | Text | NULLABLE | é¡¹ç›®æè¿° |
| color | TEXT | String(7) | DEFAULT '#667eea' | é¡¹ç›®é¢œè‰²æ ‡è¯†(HEX) |
| created_at | TIMESTAMP | DateTime | DEFAULT utcnow | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DateTime | DEFAULT utcnow, onupdate | æ›´æ–°æ—¶é—´ |

---

**tasksè¡¨ï¼ˆä»»åŠ¡ï¼‰**ï¼š

| å­—æ®µ | ç±»å‹ï¼ˆè®¾è®¡ï¼‰ | å®é™…ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------------|---------|------|------|
| id | TEXT | **INTEGER** | PRIMARY KEY AUTOINCREMENT | âš ï¸ å®é™…ä½¿ç”¨è‡ªå¢ID |
| title | TEXT | String(500) | NOT NULL | ä»»åŠ¡æ ‡é¢˜ |
| description | TEXT | Text | NULLABLE | ä»»åŠ¡æè¿° |
| status | TEXT | String(50) | DEFAULT 'pending' | âœ… å®é™…æ”¯æŒ4ç§çŠ¶æ€: pending/in_progress/completed/**overdue** |
| priority | INTEGER | Integer | DEFAULT 3 | âš ï¸ é»˜è®¤å€¼ä¸º3 (1=æœ€é«˜, 5=æœ€ä½) |
| due_date | TIMESTAMP | DateTime | NULLABLE | æˆªæ­¢æ—¶é—´ |
| **start_time** | - | **DateTime** | NULLABLE | âœ… å®é™…æ–°å¢å­—æ®µ - ä»»åŠ¡å¼€å§‹æ—¶é—´ |
| **end_time** | - | **DateTime** | NULLABLE | âœ… å®é™…æ–°å¢å­—æ®µ - ä»»åŠ¡ç»“æŸæ—¶é—´ |
| **snooze_until** | TIMESTAMP | DateTime | NULLABLE | **å»¶ååˆ°ä½•æ—¶ï¼ˆå…³é”®å­—æ®µï¼‰** |
| completed_at | TIMESTAMP | DateTime | NULLABLE | å®Œæˆæ—¶é—´ |
| project_id | TEXT | **INTEGER** | FOREIGN KEY | æ‰€å±é¡¹ç›®ID |
| parent_task_id | TEXT | **INTEGER** | FOREIGN KEY | çˆ¶ä»»åŠ¡IDï¼ˆå­ä»»åŠ¡ï¼‰ |
| ~~order_index~~ | INTEGER | âŒ | âŒ | âš ï¸ å®é™…æœªå®ç° |
| created_at | TIMESTAMP | DateTime | DEFAULT utcnow | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DateTime | DEFAULT utcnow, onupdate | æ›´æ–°æ—¶é—´ |

**çº¦æŸ**ï¼š
- CheckConstraint: `status IN ('pending', 'in_progress', 'completed', 'overdue')`

**ç´¢å¼•**ï¼š
- âš ï¸ å®é™…æœªæ˜¾å¼åˆ›å»ºé¢å¤–ç´¢å¼•,ä»…ä¸»é”®å’Œå¤–é”®è‡ªåŠ¨ç´¢å¼•

---

**notesè¡¨ï¼ˆç¬”è®°ï¼‰**ï¼š

| å­—æ®µ | ç±»å‹ï¼ˆè®¾è®¡ï¼‰ | å®é™…ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------------|---------|------|------|
| id | TEXT | **INTEGER** | PRIMARY KEY AUTOINCREMENT | âš ï¸ å®é™…ä½¿ç”¨è‡ªå¢ID |
| title | TEXT | String(500) | NOT NULL | ç¬”è®°æ ‡é¢˜ |
| content | TEXT | Text | NOT NULL | Markdownæ ¼å¼å†…å®¹(ç”¨äºRAG) |
| source_url | TEXT | String(2048) | NULLABLE | æ¥æºURLï¼ˆå¯è¿½æº¯ï¼‰ |
| **project_id** | - | **INTEGER** | FOREIGN KEY NULLABLE | âœ… å®é™…æ–°å¢å­—æ®µ - æ‰€å±é¡¹ç›® |
| created_at | TIMESTAMP | DateTime | DEFAULT utcnow | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DateTime | DEFAULT utcnow, onupdate | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- âš ï¸ å®é™…æœªæ˜¾å¼åˆ›å»ºç´¢å¼•

---

**tagsè¡¨ï¼ˆæ ‡ç­¾ï¼‰**ï¼š

| å­—æ®µ | ç±»å‹ï¼ˆè®¾è®¡ï¼‰ | å®é™…ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------------|---------|------|------|
| id | TEXT | **INTEGER** | PRIMARY KEY AUTOINCREMENT | âš ï¸ å®é™…ä½¿ç”¨è‡ªå¢ID |
| name | TEXT | String(100) | UNIQUE NOT NULL, INDEX | æ ‡ç­¾åç§° |
| color | TEXT | String(7) | NULLABLE | æ ‡ç­¾é¢œè‰²(HEX) |
| created_at | TIMESTAMP | DateTime | DEFAULT utcnow | åˆ›å»ºæ—¶é—´ |

---

**note_tagsè¡¨ï¼ˆç¬”è®°-æ ‡ç­¾å¤šå¯¹å¤šï¼‰**ï¼š

| å­—æ®µ | ç±»å‹ï¼ˆè®¾è®¡ï¼‰ | å®é™…ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------------|---------|------|------|
| note_id | TEXT | **INTEGER** | PRIMARY KEY, FOREIGN KEY ondelete CASCADE | ç¬”è®°ID |
| tag_id | TEXT | **INTEGER** | PRIMARY KEY, FOREIGN KEY ondelete CASCADE | æ ‡ç­¾ID |

---

**conversationsè¡¨ï¼ˆå¯¹è¯ï¼‰** - âŒ **æœªå®ç°**ï¼š

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| âŒ æ­¤è¡¨æœªå®ç° | - | - | å¯¹è¯åŠŸèƒ½è®¡åˆ’åç»­ç‰ˆæœ¬å®ç° |

---

**messagesè¡¨ï¼ˆæ¶ˆæ¯ï¼‰** - âŒ **æœªå®ç°**ï¼š

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| âŒ æ­¤è¡¨æœªå®ç° | - | - | æ¶ˆæ¯åŠŸèƒ½è®¡åˆ’åç»­ç‰ˆæœ¬å®ç° |

---

**user_profile_memoriesè¡¨ï¼ˆç”¨æˆ·ç”»åƒè®°å¿†ï¼‰**ï¼š

| å­—æ®µ | ç±»å‹ï¼ˆè®¾è®¡ï¼‰ | å®é™…ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------------|---------|------|------|
| id | TEXT | **INTEGER** | PRIMARY KEY AUTOINCREMENT | âš ï¸ å®é™…ä½¿ç”¨è‡ªå¢ID |
| **memory_key** | - | **String(255)** | UNIQUE NOT NULL | âœ… å®é™…å­—æ®µ - è®°å¿†å”¯ä¸€é”® |
| ~~memory_type~~ | TEXT | âŒ | âŒ | âš ï¸ è®¾è®¡ä¸­çš„å­—æ®µ,å®é™…æ”¹ä¸ºmemory_key |
| **memory_value** | - | **Text** | NOT NULL | âœ… å®é™…å­—æ®µ - è®°å¿†å†…å®¹ |
| ~~content~~ | TEXT | âŒ | âŒ | âš ï¸ è®¾è®¡ä¸­çš„å­—æ®µ,å®é™…æ”¹ä¸ºmemory_value |
| **confidence_score** | REAL | **Integer** | DEFAULT 100 | âš ï¸ å®é™…å­˜å‚¨0-100çš„æ•´æ•°å€¼ |
| ~~source_conversation_id~~ | TEXT | âŒ | âŒ | âš ï¸ æœªå®ç° |
| is_active | BOOLEAN | Boolean | DEFAULT TRUE | è½¯åˆ é™¤æ ‡è®° |
| created_at | TIMESTAMP | DateTime | DEFAULT utcnow | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DateTime | DEFAULT utcnow, onupdate | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- âš ï¸ å®é™…æœªæ˜¾å¼åˆ›å»ºé¢å¤–ç´¢å¼•

---

#### **2.2. ChromaDBå‘é‡æ•°æ®åº“è®¾è®¡**

**Collectionåç§°**: `note_embeddings`

**æ•°æ®ç»“æ„**:
```json
{
    "id": "note_uuid",
    "embedding": [0.1, 0.2, ...],
    "metadata": {
        "note_id": "note_uuid",
        "title": "ç¬”è®°æ ‡é¢˜",
        "source_url": "æ¥æºURL",
        "tags": ["tag1", "tag2"],
        "created_at": "2025-10-30T12:00:00"
    },
    "document": "ç¬”è®°å†…å®¹çš„æ–‡æœ¬å½¢å¼"
}
```

**æ£€ç´¢ç­–ç•¥**ï¼š
- **ç›¸ä¼¼åº¦æœç´¢**ï¼šä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦
- **æ··åˆæœç´¢**ï¼šç»“åˆå…³é”®è¯å’Œè¯­ä¹‰æœç´¢
- **å…ƒæ•°æ®è¿‡æ»¤**ï¼šæŒ‰æ ‡ç­¾ã€æ—¥æœŸèŒƒå›´ç­›é€‰

---

#### **2.3. Mem0è®°å¿†ç³»ç»Ÿè®¾è®¡**

**å­˜å‚¨å†…å®¹**ï¼š
- å¯¹è¯å†å²ï¼ˆè‡ªåŠ¨ç®¡ç†æ»‘åŠ¨çª—å£ï¼‰
- ç”¨æˆ·åå¥½ï¼ˆä»å¯¹è¯ä¸­æå–ï¼‰
- ä¸Šä¸‹æ–‡è®°å¿†ï¼ˆè·¨å¯¹è¯çš„é•¿æœŸè®°å¿†ï¼‰

**æ ¸å¿ƒAPI**ï¼š
- `mem0.add()` - æ·»åŠ è®°å¿†
- `mem0.search()` - æ£€ç´¢ç›¸å…³è®°å¿†
- `mem0.update()` - æ›´æ–°è®°å¿†

---

### **3. APIå±‚è®¾è®¡ (API Layer Design)**

#### **3.1. APIç«¯ç‚¹æ€»è§ˆ**

**å®ç°çŠ¶æ€**: âœ… å·²å®ç° | â¸ï¸ ä¸´æ—¶ç¦ç”¨ | âŒ æœªå®ç°

```
åŸºç¡€è·¯å¾„ï¼šhttp://localhost:8000/api

ä»»åŠ¡ç›¸å…³ï¼š
  âœ… POST   /tasks                    - åˆ›å»ºä»»åŠ¡
  âŒ POST   /tasks/batch              - æ‰¹é‡åˆ›å»ºä»»åŠ¡ï¼ˆæœªå®ç°ï¼‰
  â¸ï¸ POST   /tasks/ignite             - ä»»åŠ¡å¯åŠ¨ä»ªå¼ï¼ˆAIåˆ†è§£ï¼‰ï¼ˆä¸´æ—¶ç¦ç”¨ï¼Œä»£ç å­˜åœ¨ï¼‰
  â¸ï¸ GET    /tasks/agent/visualization - Agentå¯è§†åŒ–ï¼ˆä¸´æ—¶ç¦ç”¨ï¼Œä»£ç å­˜åœ¨ï¼‰
  âœ… GET    /tasks                    - è·å–ä»»åŠ¡åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€è¿‡æ»¤ã€åŒ…å«/æ’é™¤å»¶åä»»åŠ¡ï¼‰
  âœ… GET    /tasks/{id}               - è·å–å•ä¸ªä»»åŠ¡
  âœ… PUT    /tasks/{id}               - æ›´æ–°ä»»åŠ¡
  âœ… DELETE /tasks/{id}               - åˆ é™¤ä»»åŠ¡
  âœ… POST   /tasks/{id}/snooze        - å»¶å/é‡æ–°å®‰æ’ä»»åŠ¡ï¼ˆå¤æ‚æ—¶é—´è°ƒåº¦é€»è¾‘ï¼‰
  âŒ POST   /tasks/{id}/complete      - å®Œæˆä»»åŠ¡ï¼ˆé€šè¿‡PUTæ›´æ–°statuså®ç°ï¼‰

ç¬”è®°ç›¸å…³ï¼š
  âœ… POST   /notes                    - åˆ›å»ºç¬”è®°
  âœ… GET    /notes                    - è·å–ç¬”è®°åˆ—è¡¨
  âœ… GET    /notes/{id}               - è·å–å•ä¸ªç¬”è®°
  âœ… PUT    /notes/{id}               - æ›´æ–°ç¬”è®°
  âœ… DELETE /notes/{id}               - åˆ é™¤ç¬”è®°
  âœ… GET    /notes/search/semantic    - è¯­ä¹‰æœç´¢ç¬”è®°

é™„ä»¶ç›¸å…³ï¼š
  âœ… POST   /attachments/upload       - ä¸Šä¼ é™„ä»¶
  âœ… GET    /attachments/{id}         - è·å–é™„ä»¶ä¿¡æ¯
  âœ… GET    /attachments/{id}/download - ä¸‹è½½é™„ä»¶
  âœ… DELETE /attachments/{id}         - åˆ é™¤é™„ä»¶
  âœ… GET    /notes/{note_id}/attachments - è·å–ç¬”è®°çš„æ‰€æœ‰é™„ä»¶

é“¾æ¥ç›¸å…³ï¼š
  âœ… POST   /links                    - åˆ›å»ºç¬”è®°é“¾æ¥
  âœ… GET    /links                    - è·å–é“¾æ¥åˆ—è¡¨
  âœ… GET    /notes/{id}/links         - è·å–ç¬”è®°çš„æ‰€æœ‰é“¾æ¥
  âœ… GET    /notes/{id}/backlinks     - è·å–ç¬”è®°çš„åå‘é“¾æ¥
  âœ… DELETE /links/{id}               - åˆ é™¤é“¾æ¥

é¡¹ç›®ç›¸å…³ï¼š
  âœ… POST   /projects                 - åˆ›å»ºé¡¹ç›®
  âœ… GET    /projects                 - è·å–é¡¹ç›®åˆ—è¡¨
  âœ… GET    /projects/{id}            - è·å–å•ä¸ªé¡¹ç›®
  âœ… PUT    /projects/{id}            - æ›´æ–°é¡¹ç›®
  âœ… DELETE /projects/{id}            - åˆ é™¤é¡¹ç›®

å¯¹è¯ç›¸å…³ï¼ˆæœªå®ç°ï¼‰ï¼š
  âŒ POST   /chat/conversations       - åˆ›å»ºå¯¹è¯
  âŒ GET    /chat/conversations       - è·å–å¯¹è¯åˆ—è¡¨
  âŒ GET    /chat/conversations/{id}/messages - è·å–å¯¹è¯æ¶ˆæ¯
  âŒ POST   /chat/conversations/{id}/messages - å‘é€æ¶ˆæ¯

å¤ç›˜ç›¸å…³ï¼ˆæœªå®ç°ï¼‰ï¼š
  âŒ GET    /review/statistics        - è·å–ç»Ÿè®¡æ•°æ®
  âŒ GET    /review/insights          - è·å–æ´å¯Ÿåˆ†æ
  âŒ POST   /review/generate-report   - ç”Ÿæˆå¤ç›˜æŠ¥å‘Š
```

**æ³¨æ„**:
- `/tasks/ignite` å’Œ `/tasks/agent/visualization` å› langgraphä¾èµ–é—®é¢˜ä¸´æ—¶ç¦ç”¨ï¼ˆä»£ç å­˜åœ¨ä½†APIç«¯ç‚¹è¢«æ³¨é‡Šï¼‰
- **ä»»åŠ¡å»¶ååŠŸèƒ½**: `POST /tasks/{id}/snooze` å·²å®Œæ•´å®ç°ï¼Œæ”¯æŒå¤æ‚çš„æ—¶é—´è°ƒåº¦é€»è¾‘ï¼ˆmode="start"/end", duration_hoursç­‰ï¼‰
- **ä»»åŠ¡å®ŒæˆåŠŸèƒ½**: é€šè¿‡ `PUT /tasks/{id}` æ›´æ–° `status='completed'` å’Œ `completed_at` å­—æ®µå®ç°
- **è‡ªåŠ¨çŠ¶æ€è®¡ç®—**: `GET /tasks` ä¼šæ ¹æ® `start_time`/`end_time` è‡ªåŠ¨è®¡ç®—ä»»åŠ¡çŠ¶æ€ï¼ˆpending/in_progressï¼‰
- **é™„ä»¶ç®¡ç†**: å®Œæ•´å®ç°æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹ï¼Œä½¿ç”¨`file_storage.py`æœåŠ¡
- **ç¬”è®°é“¾æ¥**: å®ç°ç¬”è®°é—´çš„åŒå‘é“¾æ¥åŠŸèƒ½ï¼Œæ”¯æŒWikié£æ ¼çš„çŸ¥è¯†ç½‘ç»œæ„å»º
- å¯¹è¯å’Œå¤ç›˜ç›¸å…³APIåç»­ç‰ˆæœ¬å®ç°

**å®é™…å®ç°äº®ç‚¹**:
- âœ… ä»»åŠ¡åˆ—è¡¨APIæ”¯æŒåˆ†é¡µ (page, page_size)
- âœ… æ”¯æŒè¿‡æ»¤ (project_id, status, include_snoozed)
- âœ… å»¶åAPIæ”¯æŒä¸¤ç§æ¨¡å¼ (è°ƒæ•´å¼€å§‹æ—¶é—´ vs è°ƒæ•´ç»“æŸæ—¶é—´)
- âœ… æµ®åŠ¨ä»»åŠ¡ï¼ˆæ— æ—¶é—´ï¼‰è‡ªåŠ¨åˆ†é…æ—¶é•¿
- âœ… UTF-8ä¸­æ–‡ç¼–ç å®Œæ•´æ”¯æŒ (UTF8JSONResponse + ä¸­é—´ä»¶)

---

#### **3.2. å…³é”®APIç«¯ç‚¹è¯¦ç»†è®¾è®¡**

##### **3.2.1. ä»»åŠ¡å¯åŠ¨ä»ªå¼API**

**ç«¯ç‚¹**ï¼š`POST /api/tasks/ignite`

**è¯·æ±‚ä½“Schema**ï¼š
```typescript
interface TaskIgniteRequest {
  description: string;      // ä»»åŠ¡æè¿° (5-500å­—ç¬¦)
  project_id?: string;      // å¯é€‰ï¼šæ‰€å±é¡¹ç›®ID
}
```

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```json
{
  "description": "å‡†å¤‡ä¸‹å‘¨çš„é¡¹ç›®æ¼”ç¤º",
  "project_id": "project_uuid"
}
```

**å“åº”ä½“Schema**ï¼š
```typescript
interface TaskIgniteResponse {
  main_task: {
    title: string;
    description: string;
    suggested_due_date?: string;  // ISO 8601æ ¼å¼
  };
  subtasks: Array<{
    title: string;
    description: string;
    estimated_time: number;       // åˆ†é’Ÿ
    order: number;
  }>;
  related_notes: Array<{
    id: string;
    title: string;
    excerpt: string;              // å‰200å­—
    relevance_score: number;      // 0-1ç›¸å…³åº¦
  }>;
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "main_task": {
    "title": "å‡†å¤‡ä¸‹å‘¨çš„é¡¹ç›®æ¼”ç¤º",
    "description": "åŒ…å«PPTåˆ¶ä½œã€æ¼”ç¤ºç¨¿æ’°å†™ã€Demoå‡†å¤‡ç­‰å­ä»»åŠ¡",
    "suggested_due_date": "2025-11-08T14:00:00Z"
  },
  "subtasks": [
    {
      "title": "å›é¡¾ä¸Šæ¬¡æ¼”ç¤ºçš„PPT",
      "description": "æ£€æŸ¥ç°æœ‰å†…å®¹ï¼Œç¡®å®šå¯å¤ç”¨éƒ¨åˆ†",
      "estimated_time": 30,
      "order": 1
    }
  ],
  "related_notes": [
    {
      "id": "note_uuid_1",
      "title": "ä¸Šæ¬¡é¡¹ç›®æ¼”ç¤ºæ€»ç»“",
      "excerpt": "ä¸Šæ¬¡æ¼”ç¤ºä¸­å®¢æˆ·å…³æ³¨çš„é‡ç‚¹æ˜¯...",
      "relevance_score": 0.92
    }
  ]
}
```

**å¤„ç†æµç¨‹**ï¼š
1. æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„ä»»åŠ¡æè¿°
2. è°ƒç”¨Task Igniter Agentè¿›è¡Œä»»åŠ¡åˆ†è§£
3. è°ƒç”¨Knowledge Serviceæ£€ç´¢ç›¸å…³ç¬”è®°
4. ç»„è£…å“åº”è¿”å›ç»™å‰ç«¯

---

##### **3.2.2. è¯­ä¹‰æœç´¢ç¬”è®°API**

**ç«¯ç‚¹**ï¼š`GET /api/notes/search/semantic`

**æŸ¥è¯¢å‚æ•°**ï¼š
```typescript
interface SemanticSearchParams {
  query: string;        // æœç´¢æŸ¥è¯¢
  limit?: number;       // è¿”å›ç»“æœæ•°é‡ï¼ˆé»˜è®¤10ï¼‰
}
```

**å“åº”ä½“Schema**ï¼š
```typescript
interface SemanticSearchResponse {
  results: Array<{
    id: string;
    title: string;
    content: string;          // å®Œæ•´Markdownå†…å®¹
    tags: string[];
    source_url?: string;
    relevance_score: number;  // 0-1ç›¸å…³åº¦
    created_at: string;       // ISO 8601æ ¼å¼
  }>;
  total: number;
  query: string;
}
```

---

### **4. æœåŠ¡å±‚è®¾è®¡ (Service Layer Design)**

**å½“å‰å®ç°çŠ¶æ€**: â¸ï¸ å¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ç›´æ¥åœ¨APIå±‚å®ç°ï¼Œæœªå»ºç«‹ç‹¬ç«‹Serviceæ–‡ä»¶

#### **4.1. TaskServiceèŒè´£**

**è®¾è®¡æ–¹æ³•** (ç›®æ ‡æ¶æ„)ï¼š
- `create_task()` - åˆ›å»ºå•ä¸ªä»»åŠ¡
- `create_tasks_batch()` - æ‰¹é‡åˆ›å»ºä»»åŠ¡
- `ignite_task()` - è°ƒç”¨ä»»åŠ¡å¯åŠ¨ä»ªå¼Agent
- `get_tasks()` - è·å–ä»»åŠ¡åˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰ï¼‰
- `snooze_task()` - å»¶åä»»åŠ¡
- `complete_task()` - å®Œæˆä»»åŠ¡
- `update_task()` - æ›´æ–°ä»»åŠ¡
- `delete_task()` - åˆ é™¤ä»»åŠ¡

**å®é™…å®ç°**:
- â¸ï¸ æ ¸å¿ƒé€»è¾‘ç›´æ¥åœ¨ `api/endpoints/tasks.py` å®ç°
- âœ… `calculate_task_status()` - è‡ªåŠ¨è®¡ç®—ä»»åŠ¡çŠ¶æ€çš„è¾…åŠ©å‡½æ•°ï¼ˆåœ¨tasks.pyä¸­ï¼‰
- âœ… Snoozeé€»è¾‘å®Œæ•´å®ç°ï¼ˆå¤æ‚æ—¶é—´è°ƒåº¦ï¼Œæ”¯æŒmode="start"/end"ï¼‰
- âŒ æœªå»ºç«‹ç‹¬ç«‹ `services/task_service.py` æ–‡ä»¶

---

#### **4.2. KnowledgeServiceèŒè´£ï¼ˆRAGç³»ç»Ÿï¼‰**

**æ ¸å¿ƒæ–¹æ³•**ï¼š
- `semantic_search()` - è¯­ä¹‰æœç´¢ç¬”è®°
- `add_note_to_index()` - å°†ç¬”è®°æ·»åŠ åˆ°å‘é‡ç´¢å¼•
- `update_note_in_index()` - æ›´æ–°å‘é‡ç´¢å¼•ä¸­çš„ç¬”è®°
- `delete_note_from_index()` - ä»å‘é‡ç´¢å¼•åˆ é™¤ç¬”è®°

**å®é™…å®ç°**:
- âœ… `services/vector_store.py` - VectorStoreServiceç±»
- âœ… ChromaDBé›†æˆå®Œæˆï¼ˆcollection: "knowledge_base"ï¼‰
- âœ… åŸºç¡€RAGå®ç°ï¼ˆæ— åˆ†å—å¢å¼ºï¼Œç›´æ¥å‘é‡åŒ–æ•´ç¯‡ç¬”è®°ï¼‰
- âŒ é«˜çº§åŠŸèƒ½æœªå®ç°ï¼ˆMarkdownæ„ŸçŸ¥åˆ†å—ã€Rerankingã€å¤šæ­¥æ¨ç†æ£€ç´¢ï¼‰

**RAGæµç¨‹**ï¼š
1. æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢
2. ä½¿ç”¨ChromaDBè¿›è¡Œå‘é‡æœç´¢
3. æ£€ç´¢top-kç›¸å…³æ–‡æ¡£
4. ç»„è£…ç»“æœï¼ˆåŒ…å«å…ƒæ•°æ®ï¼‰
5. è¿”å›ç»™ä¸Šå±‚è°ƒç”¨è€…

---

### **5. Agentè®¾è®¡**

æœ¬é¡¹ç›®**è®¡åˆ’**é‡‡ç”¨ **Agno** æ¡†æ¶æ„å»ºAI Agentç³»ç»Ÿï¼ˆç›®æ ‡æ¶æ„ï¼‰ã€‚

**å½“å‰å®ç°çŠ¶æ€**:
- âœ… **Task Igniter Agent** - ä½¿ç”¨LangGraph StateGraphå®ç°
  - æ–‡ä»¶: `agents/task_igniter_agent.py`
  - æ¶æ„: 4ä¸ªèŠ‚ç‚¹ï¼ˆanalyze_task, decompose_task, retrieve_notes, finalizeï¼‰
  - è·¯ç”±: æ¡ä»¶è¾¹ï¼ˆroute_after_analyze, route_after_decomposeï¼‰
  - çŠ¶æ€: TypedDictå®šä¹‰ï¼ˆTaskIgniterStateï¼‰
  - APIç«¯ç‚¹: å·²å®ç°ä½†ä¸´æ—¶ç¦ç”¨ï¼ˆLine 280-350 in tasks.pyï¼‰
- âŒ **Triage Agent** - æœªå®ç°
- âŒ **Cognitive Team** - æœªå®ç°
- âŒ **Reflection Agent** - æœªå®ç°

**Agnoè¿ç§»è¦ç‚¹**ï¼ˆç›®æ ‡æ¶æ„ï¼‰:
- ä½¿ç”¨ `from agno.agent import Agent` æ›¿ä»£ StateGraph
- åˆ©ç”¨å†…ç½® `knowledge`, `db`, `enable_user_memories` ç‰¹æ€§
- ç®€åŒ–ä»£ç ï¼šLangGraph 300è¡Œ â†’ Agno é¢„è®¡50-80è¡Œ
- è‡ªåŠ¨ä¼šè¯ç®¡ç†ï¼ˆsession_idï¼‰
- è‡ªåŠ¨çŸ¥è¯†æ£€ç´¢ï¼ˆsearch_knowledge=Trueï¼‰

**æ ¸å¿ƒAgent**ï¼ˆç›®æ ‡æ¶æ„ï¼‰ï¼š
- **Task Igniter Agent**: ä»»åŠ¡å¯åŠ¨ä»ªå¼ï¼ŒAIè¾…åŠ©ä»»åŠ¡åˆ†è§£
- **Triage Agent**: æ„å›¾åˆ†ç±»ï¼Œè·¯ç”±åˆ†å‘
- **Cognitive Team**: Planner + Executor å¤šAgentåä½œ
- **Reflection Agent**: ä»»åŠ¡ååæ€å­¦ä¹ 

**è¯¦ç»†è®¾è®¡æ–‡æ¡£**: å‚è§ [Agentè¯¦ç»†è®¾è®¡.md](./Agentè¯¦ç»†è®¾è®¡.md)

è¯¥æ–‡æ¡£åŒ…å«ï¼š
- Agno vs LangGraphå¯¹æ¯”åˆ†æ
- 4ä¸ªAgentçš„å®Œæ•´å®ç°ä»£ç ï¼ˆAgnoç‰ˆæœ¬ï¼‰
- æ•°æ®åº“é…ç½®(SQLite + ChromaDB)
- APIé›†æˆç¤ºä¾‹
- æœ€ä½³å®è·µå’Œæµ‹è¯•ç­–ç•¥

---

### **6. LLM Factory - ç»Ÿä¸€LLMæ¥å£**

#### **6.1. è®¾è®¡ç›®çš„**

ç»Ÿä¸€ä¸åŒLLMæä¾›å•†ï¼ˆOpenAIã€Claudeã€Ollamaï¼‰çš„æ¥å£ï¼Œå®ç°å¯æ’æ‹”çš„LLMé€‰æ‹©ã€‚

#### **6.2. æ”¯æŒçš„æä¾›å•†**

| æä¾›å•† | æ¨¡å‹ç¤ºä¾‹ | ä½¿ç”¨åœºæ™¯ |
|--------|----------|----------|
| OpenAI | gpt-4, gpt-3.5-turbo | ç”Ÿäº§ç¯å¢ƒ |
| Claude | claude-3-opus, claude-3-sonnet | ç”Ÿäº§ç¯å¢ƒ |
| Ollama | llama2, mistral | æœ¬åœ°å¼€å‘/æµ‹è¯• |

#### **6.3. é…ç½®æ–¹å¼**

é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®LLMæä¾›å•†ï¼š

```bash
# .envæ–‡ä»¶
LLM_PROVIDER=openai
LLM_MODEL=gpt-4
OPENAI_API_KEY=sk-xxx
OPENAI_API_BASE=https://api.openai.com/v1
```

#### **6.4. ä½¿ç”¨æ–¹å¼**

```python
from app.core.llm_factory import get_llm

# ä½¿ç”¨é»˜è®¤é…ç½®
llm = get_llm()

# è¦†ç›–é…ç½®
llm = get_llm(provider="claude", model="claude-3-sonnet", temperature=0.5)
```

---

### **7. æ•°æ®éªŒè¯ (Pydantic Schemas)**

#### **7.1. Schemaè®¾è®¡åŸåˆ™**

- **TaskBase**: åŸºç¡€å­—æ®µå®šä¹‰
- **TaskCreate**: åˆ›å»ºæ—¶çš„å¿…å¡«å­—æ®µ
- **TaskUpdate**: æ›´æ–°æ—¶çš„å¯é€‰å­—æ®µ
- **Task**: å®Œæ•´æ•°æ®ï¼ˆåŒ…å«IDã€æ—¶é—´æˆ³ï¼‰

#### **7.2. æ ¸å¿ƒSchemaå®šä¹‰**

**TaskBase**:
```python
class TaskBase(BaseModel):
    title: str = Field(..., min_length=1, max_length=500)
    description: Optional[str] = None
    status: str = Field(default="pending", pattern="^(pending|in_progress|completed|overdue)$")
    priority: int = Field(default=3, ge=1, le=5)
    start_time: Optional[datetime] = None  # ä»»åŠ¡å¼€å§‹æ—¶é—´ï¼ˆå¿…å¡«ï¼‰
    end_time: Optional[datetime] = None    # ä»»åŠ¡ç»“æŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰
    snooze_until: Optional[datetime] = None  # å»¶ååˆ°ä½•æ—¶
    project_id: Optional[int] = None
```

**TaskCreate**:
```python
class TaskCreate(TaskBase):
    pass  # ç»§æ‰¿æ‰€æœ‰å­—æ®µ
```

**TaskUpdate**:
```python
class TaskUpdate(BaseModel):
    title: Optional[str] = Field(None, min_length=1, max_length=500)
    description: Optional[str] = None
    status: Optional[str] = Field(None, pattern="^(pending|in_progress|completed|overdue)$")
    priority: Optional[int] = Field(None, ge=1, le=5)
    start_time: Optional[datetime] = None
    end_time: Optional[datetime] = None
    snooze_until: Optional[datetime] = None
```

**Task**ï¼ˆå®Œæ•´æ•°æ®ï¼‰:
```python
class Task(TaskBase):
    id: str
    created_at: datetime
    updated_at: datetime
    snooze_until: Optional[datetime] = None
    completed_at: Optional[datetime] = None

    class Config:
        from_attributes = True  # Pydantic v2è¯­æ³•
```

---

### **8. å®æ–½å»ºè®®ä¸æ€»ç»“**

#### **8.1. å¼€å‘ä¼˜å…ˆçº§**

**P0ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ - MVPæ ¸å¿ƒï¼‰**ï¼š
1. æ•°æ®åº“æ¨¡å‹å®šä¹‰ï¼ˆSQLAlchemy Modelsï¼‰
2. CRUDå±‚å®ç°ï¼ˆTaskCRUDã€NoteCRUDï¼‰
3. åŸºç¡€APIç«¯ç‚¹ï¼ˆåˆ›å»º/è·å–/æ›´æ–°ä»»åŠ¡ã€ç¬”è®°ï¼‰
4. Task Igniter AgentåŸºç¡€ç‰ˆï¼ˆç®€å•åˆ†è§£ï¼‰
5. ChromaDBé›†æˆå’Œè¯­ä¹‰æœç´¢

**P1ï¼ˆé‡è¦åŠŸèƒ½ï¼‰**ï¼š
6. Task Igniter Agentå®Œæ•´ç‰ˆï¼ˆçŠ¶æ€é©±åŠ¨ã€å¤šæ­¥éª¤ï¼‰
7. çŸ¥è¯†æ£€ç´¢æœåŠ¡ï¼ˆKnowledgeServiceï¼‰
8. ä»»åŠ¡å»¶ååŠŸèƒ½å®Œæ•´å®ç°
9. Mem0é›†æˆï¼ˆå¯¹è¯è®°å¿†ï¼‰
10. Chat APIå®Œæ•´å®ç°

**P2ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰**ï¼š
11. Review Coach Agent
12. å¤ç›˜æ•°æ®ç»Ÿè®¡API
13. é€šçŸ¥æœåŠ¡ï¼ˆæµè§ˆå™¨é€šçŸ¥ï¼‰
14. æ•°æ®åº“è¿ç§»ï¼ˆAlembicï¼‰

**P3ï¼ˆä¼˜åŒ–å’Œæ‰©å±•ï¼‰**ï¼š
15. ç”¨æˆ·è®¤è¯å’Œæˆæƒ
16. æ—¥å¿—å’Œç›‘æ§
17. å•å…ƒæµ‹è¯•è¦†ç›–
18. APIæ–‡æ¡£å®Œå–„

---

#### **8.2. å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“**

**LangGraph Agentæœ€ä½³å®è·µ**ï¼š
- âœ… ä½¿ç”¨TypedDictå®šä¹‰çŠ¶æ€ï¼ˆç±»å‹å®‰å…¨ï¼‰
- âœ… èŠ‚ç‚¹å‡½æ•°ä¿æŒçº¯ç²¹ï¼ˆæ— å‰¯ä½œç”¨ï¼‰
- âœ… æ¡ä»¶è·¯ç”±åŸºäºçŠ¶æ€å­—æ®µ
- âœ… å›¾ç¼–è¯‘åå¯åºåˆ—åŒ–ï¼ˆæ”¯æŒæŒä¹…åŒ–ï¼‰
- âœ… æ”¯æŒå¯è§†åŒ–ï¼ˆMermaidå›¾ï¼‰

**æ•°æ®åº“è®¾è®¡æœ€ä½³å®è·µ**ï¼š
- âœ… ä½¿ç”¨UUIDä½œä¸ºä¸»é”®ï¼ˆå­—ç¬¦ä¸²IDï¼‰
- âœ… åˆ›å»ºåˆé€‚çš„ç´¢å¼•ï¼ˆæé«˜æŸ¥è¯¢æ€§èƒ½ï¼‰
- âœ… å¤–é”®çº¦æŸç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- âœ… æ—¶é—´æˆ³å­—æ®µè‡ªåŠ¨æ›´æ–°ï¼ˆupdated_atï¼‰
- âœ… è½¯åˆ é™¤æ ‡è®°ï¼ˆis_activeï¼‰è€Œéç¡¬åˆ é™¤

**APIè®¾è®¡æœ€ä½³å®è·µ**ï¼š
- âœ… RESTfulé£æ ¼ï¼ˆèµ„æºå¯¼å‘ï¼‰
- âœ… Pydantic SchemaéªŒè¯ï¼ˆç±»å‹å®‰å…¨ï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆHTTPçŠ¶æ€ç ï¼‰
- âœ… è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ï¼ˆFastAPI Swaggerï¼‰
- âœ… ä¾èµ–æ³¨å…¥ç®¡ç†æ•°æ®åº“ä¼šè¯

**RAGç³»ç»Ÿæœ€ä½³å®è·µ**ï¼š
- âœ… æ–‡æ¡£åˆ†å—ç­–ç•¥ï¼ˆchunk_size: 500-1000å­—ç¬¦ï¼‰
- âœ… å‘é‡åŒ–æ—¶ä¿ç•™å…ƒæ•°æ®ï¼ˆtagsã€source_urlï¼‰
- âœ… æ··åˆæ£€ç´¢ï¼ˆå‘é‡+å…³é”®è¯ï¼‰
- âœ… é‡æ’åºï¼ˆRerankingï¼‰æé«˜ç²¾åº¦
- âœ… ç¼“å­˜çƒ­é—¨æŸ¥è¯¢ç»“æœ

---

**æ–‡æ¡£å®Œæˆï¼**
ä¸‹ä¸€æ­¥ï¼šæ ¹æ®P0ä¼˜å…ˆçº§å¼€å§‹å®æ–½å¼€å‘ã€‚
